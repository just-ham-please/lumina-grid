<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Demo-Video â€“ Lumina Grid</title>
  <link rel="stylesheet" href="../assets/styles.css">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <script defer src="../assets/script.js"></script>
  <style>
    .lock-container{max-width:420px;margin:120px auto;text-align:center;padding:24px;
      border:1px solid var(--border);border-radius:16px;background:var(--panel);backdrop-filter:blur(8px)}
    input[type=password]{width:100%;padding:10px 12px;border-radius:10px;
      border:1px solid var(--border);background:rgba(255,255,255,.05);color:var(--text);margin:10px 0}
    button{padding:10px 16px;border-radius:10px;border:1px solid var(--border);
      background:linear-gradient(90deg,var(--brand1),var(--brand2));font-weight:700;cursor:pointer}
    .error{color:#f66;margin-top:8px;font-size:14px;min-height:22px}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>

  <header class="header">
    <nav class="nav">
      <div class="brand"><span>ðŸ”· Lumina Grid</span><span class="badge">Preview</span></div>
      <div class="navlinks">
        <a href="/lumina-grid/">Home</a>
        <a href="/lumina-grid/about.html">Ãœber</a>
        <a href="/lumina-grid/videos/demo-video.html" class="active">Videos</a>
        <span class="toggle" data-toggle-theme>â˜¼/â˜¾</span>
      </div>
    </nav>
  </header>

  <main class="container">
    <!-- ðŸ”’ Lock -->
    <div id="lock" class="lock-container">
      <h2>Videozugang</h2>
      <p>Bitte Passwort eingeben, um das Demo-Video zu sehen.</p>
      <input type="password" id="pw" placeholder="Passwort" autocomplete="current-password">
      <button id="unlock">Freischalten</button>
      <div class="error" id="err"></div>
    </div>

    <!-- ðŸ”“ Content -->
    <div id="content" class="hidden">
      <section class="card reveal">
        <h1>Demo-Video</h1>
        <p>Kurzbeschreibung des Inhalts. Das Video ist â€žnicht gelistetâ€œ, bleibt aber einbettbar.</p>
        <div class="responsive-iframe" style="margin-top:16px">
          <iframe
            src="https://www.youtube-nocookie.com/embed/VIDEO_ID?rel=0"
            title="YouTube Demo"
            loading="lazy"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerpolicy="strict-origin-when-cross-origin"
            allowfullscreen></iframe>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer">
    Â© <span id="y"></span> Lumina Grid
    <script>document.getElementById('y').textContent=new Date().getFullYear()</script>
  </footer>

  <script>
    // === Clientseitige Hash-PrÃ¼fung (SHA-256) ===
    const CORRECT_HASH = "0e6ba33f8bc8f41515b9d77c0e27c07ad66f2ae9b09dd7561729d6cd4d27c292";
    const STORAGE_KEY  = "videoUnlocked_v1";

    const $ = s => document.querySelector(s);
    const lock = $("#lock"), content = $("#content"), err = $("#err"), input = $("#pw"), btn = $("#unlock");

    function toHex(buf){
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    async function sha256Hex(text){
      const enc = new TextEncoder().encode(text);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      return toHex(buf);
    }
    function timingSafeEqual(a, b){
      if (a.length !== b.length) return false;
      let out = 0;
      for (let i=0; i<a.length; i++) out |= a.charCodeAt(i) ^ b.charCodeAt(i);
      return out === 0;
    }

    async function unlock(){
      err.textContent = "";
      const hash = await sha256Hex(input.value.trim());
      if (timingSafeEqual(hash, CORRECT_HASH)){
        localStorage.setItem(STORAGE_KEY, "yes");
        lock.classList.add("hidden");
        content.classList.remove("hidden");
        // optional: input leeren
        input.value = "";
      } else {
        err.textContent = "Falsches Passwort.";
      }
    }

    btn.addEventListener("click", unlock);
    input.addEventListener("keydown", e => { if (e.key === "Enter") unlock(); });

    // Schon freigeschaltet?
    if (localStorage.getItem(STORAGE_KEY) === "yes"){
      lock.classList.add("hidden");
      content.classList.remove("hidden");
    }
  </script>
</body>
</html>
